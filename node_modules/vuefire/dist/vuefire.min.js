/*!
  * vuefire v2.1.0
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
var Vuefire=function(e){"use strict";function t(e,t,n){const r=(""+t).split("."),s=r.pop(),i=r.reduce((e,t)=>e[t],e);return Array.isArray(i)?i.splice(Number(s),1,n):i[s]=n}function n(e){return e&&"object"==typeof e}function r(e){return e.toDate}function s(e,t){for(let n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}const i={reset:!0,serialize:function(e){const t=e.val(),r=n(t)?t:Object.defineProperty({},".value",{value:t});return Object.defineProperty(r,".key",{value:e.key}),r}};function o(e,t={},s="",i=[{},{}]){t=t||{};const c=Object.getOwnPropertyDescriptor(e,"id");c&&!c.enumerable&&Object.defineProperty(i[0],"id",c);const[a,f]=i;for(const i in e){const c=e[i];if((l=c)&&l.onSnapshot)a[i]=t[i]||c.path,f[s+i]=c;else if(Array.isArray(c)){a[i]=Array(c.length).fill(null);const e=(t[i]||[]).filter(e=>-1!==c.indexOf(e));o(c,e,s+i+".",[a[i],f])}else null==c||c instanceof Date||r(c)||c.longitude&&c.latitude?a[i]=c:n(c)?(a[i]={},o(c,t[i],s+i+".",[a[i],f])):a[i]=c}var l;return i}const c={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data(),"id",{value:e.id})}};function a(e){for(const t in e)e[t].unsub()}function f({snapshot:e,target:t,path:n,subs:r,ops:s,depth:i,resolve:c},a){const[f,l]=o(e,function(e,t){return t.split(".").reduce((e,t)=>e[t],e)}(t,n));s.set(t,n,f),u({subs:r,refs:l,target:t,path:n,ops:s,depth:i,resolve:c},a)}function l({ref:e,target:t,path:n,depth:r,resolve:s,ops:i},o){const c=Object.create(null),l=e.onSnapshot(e=>{e.exists?f({snapshot:o.serialize(e),target:t,path:n,ops:i,subs:c,depth:r,resolve:s},o):(i.set(t,n,null),s(n))});return()=>{l(),a(c)}}function u({subs:e,refs:t,target:n,path:r,depth:s,ops:i,resolve:o},c){const a=Object.keys(t);if(Object.keys(e).filter(e=>a.indexOf(e)<0).forEach(t=>{e[t].unsub(),delete e[t]}),!a.length||++s>c.maxRefDepth)return o(r);let f=0;const u=a.length,d=Object.create(null);function b(e){e in d&&++f>=u&&o(r)}a.forEach(o=>{const a=e[o],f=t[o],u=`${r}.${o}`;if(d[u]=!0,a){if(a.path===f.path)return;a.unsub()}e[o]={unsub:l({ref:f,target:n,path:u,depth:s,ops:i,resolve:b.bind(null,u)},c),path:f.path}})}var d={set:function(e,n,r){return t(e,n,r)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function b(e,t,n,r){return new Promise(function(o,c){var a;a=Array.isArray(e[t])?function({vm:e,key:t,collection:n,resolve:r,reject:o,ops:c},a=i){const f=Object.assign({},i,a),l=[];c.set(e,t,l);const u=n.on("child_added",(e,t)=>{const n=t?s(l,t)+1:0;c.add(l,n,f.serialize(e))},o),d=n.on("child_removed",e=>{c.remove(l,s(l,e.key))},o),b=n.on("child_changed",e=>{c.set(l,s(l,e.key),f.serialize(e))},o),p=n.on("child_moved",(e,t)=>{const n=s(l,e.key),r=c.remove(l,n)[0],i=t?s(l,t)+1:0;c.add(l,i,r)},o);return n.once("value",r),()=>{if(n.off("child_added",u),n.off("child_changed",b),n.off("child_removed",d),n.off("child_moved",p),!1!==f.reset){const n="function"==typeof f.reset?f.reset():[];c.set(e,t,n)}}}({vm:e,key:t,collection:n,resolve:o,reject:c,ops:d},r):function({vm:e,key:t,document:n,resolve:r,reject:s,ops:o},c=i){const a=Object.assign({},i,c),f=n.on("value",n=>{o.set(e,t,a.serialize(n))},s);return n.once("value",r),()=>{if(n.off("value",f),!1!==a.reset){const n="function"==typeof a.reset?a.reset():null;o.set(e,t,n)}}}({vm:e,key:t,document:n,resolve:o,reject:c,ops:d},r),e._firebaseUnbinds[t]=a})}var p={bindName:"$rtdbBind",unbindName:"$rtdbUnbind",serialize:i.serialize},h={set:function(e,n,r){return t(e,n,r)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function v(e,t,n,r,s){return new Promise(function(i,l){var d;d="where"in n?function({vm:e,key:t,collection:n,ops:r,resolve:s,reject:i},f=c){const l=Object.assign({},c,f),d=r.set(e,t,[]),b=s;let p;const h=[],v={added:({newIndex:e,doc:t})=>{h.splice(e,0,Object.create(null));const n=h[e],i=l.serialize(t),[c,a]=o(i);r.add(d,e,c),u({refs:a,subs:n,target:d,path:e,depth:0,ops:r,resolve:s.bind(null,t)},l)},modified:({oldIndex:e,newIndex:t,doc:n})=>{const i=h.splice(e,1)[0];h.splice(t,0,i);const c=r.remove(d,e)[0],a=l.serialize(n),[f,b]=o(a,c);r.add(d,t,f),u({refs:b,subs:i,ops:r,target:d,path:t,depth:0,resolve:s},l)},removed:({oldIndex:e})=>{r.remove(d,e),a(h.splice(e,1)[0])}},y=n.onSnapshot(n=>{const r="function"==typeof n.docChanges?n.docChanges():n.docChanges;if(!p&&r.length){p=!0;let n=0;const i=r.length,o=Object.create(null);for(let e=0;e<i;e++)o[r[e].doc.id]=!0;s=({id:r})=>{r in o&&++n>=i&&(b(e[t]),s=()=>{})}}r.forEach(e=>{v[e.type](e)}),r.length||s()},i);return()=>{if(y(),!1!==l.reset){const n="function"==typeof l.reset?l.reset():[];r.set(e,t,n)}h.forEach(a)}}({vm:e,key:t,ops:r,collection:n,resolve:i,reject:l},s):function({vm:e,key:t,document:n,resolve:r,reject:s,ops:i},o=c){const l=Object.assign({},c,o),u=Object.create(null);r=function(e,t){let n=!1;return()=>{if(!n)return n=!0,e(t())}}(r,()=>e[t]);const d=n.onSnapshot(n=>{n.exists?f({snapshot:l.serialize(n),target:e,path:t,subs:u,ops:i,depth:0,resolve:r},l):r()},s);return()=>{if(d(),!1!==l.reset){const n="function"==typeof l.reset?l.reset():null;i.set(e,t,n)}a(u)}}({vm:e,key:t,ops:r,document:n,resolve:i,reject:l},s),e._firestoreUnbinds[t]=d})}var y={bindName:"$bind",unbindName:"$unbind",serialize:c.serialize};return e.firestorePlugin=function(e,t){void 0===t&&(t=y);var n=e.config.optionMergeStrategies;n.firestore=n.provide;var r=Object.assign({},y,t),s=r.bindName,i=r.unbindName;e.prototype[s]=function(e,t,n){void 0===n&&(n=r);var s=Object.assign({},r,n);this._firestoreUnbinds[e]&&this[i](e);var o=v(this,e,t,h,s);return this.$firestoreRefs[e]=t,o},e.prototype[i]=function(e){this._firestoreUnbinds[e](),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]},e.mixin({beforeCreate:function(){this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null)},created:function(){var e=this.$options.firestore,t="function"==typeof e?e.call(this):e;if(t)for(var n in t)this[s](n,t[n],r)},beforeDestroy:function(){for(var e in this._firestoreUnbinds)this._firestoreUnbinds[e]();this._firestoreUnbinds=null,this.$firestoreRefs=null}})},e.rtdbPlugin=function(e,t){void 0===t&&(t=p);var n=e.config.optionMergeStrategies;n.firebase=n.provide;var r=Object.assign({},p,t),s=r.bindName,i=r.unbindName;e.prototype[s]=function(e,t,n){void 0===n&&(n=r);var s=Object.assign({},r,n);this._firebaseUnbinds[e]&&this[i](e);var o=b(this,e,t,s);return this._firebaseSources[e]=t,this.$firebaseRefs[e]=t.ref,o},e.prototype[i]=function(e){!function(e,t){e._firebaseUnbinds[t](),delete e._firebaseSources[t],delete e._firebaseUnbinds[t]}(this,e)},e.mixin({beforeCreate:function(){this.$firebaseRefs=Object.create(null),this._firebaseSources=Object.create(null),this._firebaseUnbinds=Object.create(null)},created:function(){var e=this.$options.firebase;if("function"==typeof e&&(e=e.call(this)),e)for(var t in e)this[s](t,e[t],r)},beforeDestroy:function(){for(var e in this._firebaseUnbinds)this._firebaseUnbinds[e]();this._firebaseSources=null,this._firebaseUnbinds=null,this.$firebaseRefs=null}})},e.walkSet=t,e}({});
